var u=Object.defineProperty;var m=(s,e,r)=>e in s?u(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var l=(s,e,r)=>m(s,typeof e!="symbol"?e+"":e,r);import{c as d,e as f}from"./recaptcha-BkbUZVkf.js";const n={cssClass:s=>`.${s}`,htmlElement:s=>document.querySelector(s),errorMessage:s=>`[data-astron-error-message=${s}]`};class h{constructor(){l(this,"baseUrl");this.baseUrl=d.api.baseUrl}async get(e){const r=await fetch(`${this.baseUrl}${e}`);if(!r.ok)throw new Error(`API Error: ${r.status}`);return this.parseResponse(r)}async post(e,r){const t=await fetch(`${this.baseUrl}${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok)throw new Error(`API Error: ${t.status}`);return this.parseResponse(t)}async parseResponse(e){if(e.headers.get("content-length")==="0")return{};const t=e.headers.get("content-type");if(!t||!t.includes("application/json"))throw new Error(`Invalid content type: ${t}. Expected application/json.`);const o=await e.text();if(!o||o.trim()==="")return{};try{return JSON.parse(o)}catch(i){throw new Error(`Invalid JSON response: ${i instanceof Error?i.message:"Unknown error"}`)}}}class g extends h{async getClinicSlug(e){return this.get(`/leads/referral-redirect/${e}`)}async createLead(e){return this.post("/leads",e)}async createClinicianLead(e){return this.post("/leads?isAClinicianLead=true",e)}}const p=new g;function y(s,e){try{localStorage.setItem(s,JSON.stringify(e))}catch(r){console.error("Failed to set localStorage item:",r)}}function $(s){try{const e=localStorage.getItem(s);return e?JSON.parse(e):null}catch(e){return console.error("Failed to get localStorage item:",e),null}}const S=()=>{const e=new URLSearchParams(window.location.search).get("ref");if(e)return y(d.keys.referralId,e),e},w=async s=>{const e=n.htmlElement(f.global.pageLoader);if(!e){console.error("Page loader element not found");return}e.style.display="flex";try{const{urlSlug:r}=await p.getClinicSlug(s),t=window.location.origin;if(window.location.pathname===`/${r}`)return;const i=`${t}/${r}`;window.location.href=i}catch(r){console.error("Error fetching clinic slug:",r)}finally{setTimeout(()=>{e.style.display="none"},1e3)}};function b(){const s=S();s&&w(s)}const a={button:{loading:"loading-button"},form:{success:"w-form-done",failed:"w-form-fail"},input:{error:"text-field-error",showError:"show-error-message"}};function q(s){s.style.display="none";const e=document.querySelector(n.cssClass(a.form.failed));e&&(e.style.display="none");const r=document.querySelector(n.cssClass(a.form.success));r&&(r.style.display="block")}function C(){const s=document.querySelector(n.cssClass(a.form.failed));s&&(s.style.display="block")}const c={required:"Required",invalidName:"Please enter your first and last name",invalidEmail:"Please enter a valid email address",termsNotAccepted:"You must accept the terms and conditions"};class k{constructor(e){l(this,"form");l(this,"errors");this.form=e,this.errors={}}validateRequired(e){return e.trim().length>0}validateName(e){const r=e.trim().split(/\s+/);return r.length>=2&&r.every(t=>t.length>=2)}validateEmail(e){return/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)}validateField(e,r,t){const o=this.form.querySelector(`[name=${e}]`);o&&(this.validateRequired(o.value)||this.markFieldError(o,c.required),r&&(r(o.value)||this.markFieldError(o,t)))}validateOptionalField(e,r){const t=this.form.querySelector(`[name=${e}]`);if(!t)return;const o=t.value;r(o)||this.markFieldError(t,c.required)}validateCheckbox(e,r){const t=this.form.querySelector(`[name=${e}]`);t&&(t.checked||this.markFieldError(t,r))}markFieldError(e,r="Invalid input"){e.classList.add(a.input.error);const t=this.form.querySelector(n.errorMessage(e.name));t&&t.tagName==="P"&&(t.textContent=r,t.classList.add(a.input.showError)),this.errors[e.name]=r}resetErrors(){this.errors={},this.form.querySelectorAll(`.${a.input.error}`).forEach(r=>{r.classList.remove(a.input.error);const t=this.form.querySelector(n.errorMessage(r.name));t&&t.tagName==="P"&&(t.textContent="",t.classList.remove(a.input.showError))})}}export{h as A,k as V,y as a,C as b,a as c,b as d,$ as g,q as h,p as l,c as m,n as s};
